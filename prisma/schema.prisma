// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Team represents a dashboard team
model Team {
  id        String     @id @default(cuid())
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  slug      String     @unique // URL-friendly: "team-name"
  name      String              // Display: "Team Name"
  icon      String?             // Emoji: "ðŸ§¨"
  isActive  Boolean    @default(true)

  snapshots Snapshot[]
}

// Snapshot represents a daily data snapshot from JIRA
// Each team+release has one snapshot per day
model Snapshot {
  id        String        @id @default(cuid())
  createdAt DateTime      @default(now())
  date      DateTime

  team      Team          @relation(fields: [teamId], references: [id], onDelete: Cascade)
  teamId    String

  release   String        // e.g., "R1" - release number

  rows      SnapshotRow[]

  @@unique([date, teamId, release])
  @@index([teamId])
  @@index([date])
  @@index([release])
}

// SnapshotRow stores statistics for a single row (e.g., "Feature A")
// Contains all JIRA metrics for that row on a given day
model SnapshotRow {
  id                   String   @id @default(cuid())

  // Relation to parent Snapshot
  snapshot             Snapshot @relation(fields: [snapshotId], references: [id], onDelete: Cascade)
  snapshotId           String

  // Row identification
  tabId                String   // "displays" or "features"
  rowId                String   // e.g., "feature-1"
  label                String   // Display name, e.g., "Feature A"

  // JIRA metrics
  completedTickets     Int
  totalTickets         Int
  completedStoryPoints Float
  totalStoryPoints     Float
  progressPercent Float    // 0-100 (Story Points)
  ticketProgressPercent Float   @default(0) // 0-100 (Tickets)

  // Deadline info
  workingDaysRemaining Int
  deadline             DateTime

  @@index([snapshotId])
  @@index([tabId, rowId])
}
